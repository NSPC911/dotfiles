# requires: https://github.com/astral-sh/ruff
[language-server.ruff]
command = "ruff"
args = ["server"]

[language-server.ruff.config]
disableLanguageServices = true

# requires: https://github.com/astral-sh/ruff
[language-server.ty]
command = "ty"
args = ["server"]

# requires: https://github.com/DetachHead/basedpyright
[language-server.pyright]
command = "pyright-langserver"
args = ["--stdio"]

[language-server.pyright.config]
pyright.disableOrganizeImports = true
pyright.openFilesOnly = false
python.analysis.autoImportCompletions = true
python.analysis.typeCheckingMode = "off"

[language-server.pyright.config.python.analysis.diagnosticSeverityOverrides]
reportUndefinedVariable = "none"
reportMissingImports = "none"

# requires: https://github.com/Automattic/harper
[language-server.harper-ls]
command = "harper-ls"
args = ["--stdio"]

[language-server.harper-ls.config.harper-ls]
dialact = "British"  # shit is not british
isolateEnglish = true

[language-server.harper-ls.config.harper-ls.linters]
UnclosedQuotes = true
WrongQuotes = true
LongSentences = true
RepeatedWords = true
SpellCheck = true
SentenceCapitalization = false
NoOxfordComma = false
SpelledNumbers = false

[language-server.harper-ls.config.markdown]
IgnoreLinkTitle = true

# requires helix be built with `cargo xtask steel`
# on a supported branch
[language-server.steel]
command = "steel-language-server"
args = []

# requires: https://github.com/facebook/pyrefly/
# i don't use it currently
[language-server.pyrefly]
command = "pyrefly"
args = ["lsp"]

# requires: https://github.com/tombi-toml/tombi
[language-server.tombi]
command = "tombi"
args = ["lsp"]

# requires: https://github.com/zerootoad/discord-rpc-lsp
[language-server.discord-rpc]
command = "discord-rpc-lsp"

[language-server.codebook]
command = "codebook"
args = ["serve"]

[[language]]
name = "python"
language-servers = [
  "discord-rpc",
  "codebook",
  { name = "pyright", except-features = [
    "goto-declaration",
    "goto-type-definition",
    "goto-reference",
    "goto-implementation",
  ] },
  "ruff",
  { name = "ty", only-features = [
    "goto-declaration",
    "goto-type-definition",
    "goto-reference",
    "goto-implementation",
    "completion",
    "diagnostics",
    "inlay-hints"
  ] }
]
auto-format = true

[[language]]
name = "scss"
file-types = ["scss", "tcss"]
injection-regex = "(t|s)?css"
language-servers = [
  "discord-rpc",
  "vscode-css-language-server",
]

[[language]]
name = "scheme"
language-servers = [
  "discord-rpc",
  "steel",
]

[[language]]
name = "json"
formatter = { command = "prettierd", args = [".json"] }
language-servers = [
  "discord-rpc",
  "vscode-json-language-server",
]
auto-format = true

[[language]]
name = "javascript"
formatter = { command = "pretterd", args = [".js"] }
language-servers = [
  "discord-rpc",
  "typescript-language-server",
]
auto-format = true

[[language]]
name = "jsonc"
formatter = { command = "prettierd", args = [".jsonc"] }
language-servers = [
  "discord-rpc",
  "vscode-json-language-server",
]
auto-format = true

[[language]]
name = "yaml"
formatter = { command = "prettierd", args = [".yaml"] }
language-servers = [
  "ansible-language-server",
  "discord-rpc",
  "yaml-language-server",
]

[[language]]
name = "css"
formatter = { command = "prettierd", args = [".css"] }
language-servers = [
  "discord-rpc",
  "vscode-css-language-server",
]

[[language]]
name = "markdown"
language-servers = [
  "discord-rpc",
  "harper-ls",
  "markdown-oxide",
  "marksman",
]
formatter = { command = "prettierd", args = [".md"] }

[[language]]
name = "typst"
language-servers = [
  "discord-rpc",
  "harper-ls",
  "tinymist",
]

[[language]]
name = "toml"
language-servers = ["tombi", "discord-rpc"]
